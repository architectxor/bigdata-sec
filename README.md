# Отчет по практической работе №5 "Настройка Prometheus и Grafana на сбор данных из Falco"

В данной работе необходимо настроить Prometheus таким образом, чтобы он с помощью одного из возможных экспортеров собирал данные о работе Falco, затем нужно создать подходящий дашборд для Grafana для визуализации данных из Prometheus, и добавить Prometheus в качестве источника данных.

Для начала нужно создать файл `docker-compose.yml`, в котором прописать необходимые настройки для Prometheus, как показано на рисунке 1, затем аналогичным образом для Grafana, как показано на рисунке 2, а также для вспомогательных модулей таких, как Falco-sidekick, используемый для экспорта журналов Falco, и модуля node-exporter, для анализа производительности узла. Их настройка представлена на рисунке 3. Помимо этого, `docker-compose.yml` файл должен содержать глобальные настройки окружения для вышеуказанных контейнеров как показано на рисунке 4. Здесь осуществляется настройка общего хранилища, а также настройка сети разделяемой контейнерами.


![image](https://user-images.githubusercontent.com/49113443/146638647-7596e1e4-9929-4f4a-8532-066728f45be4.png)


Рисунок 1 – Запись для запуска Prometheus-контейнера.


![image](https://user-images.githubusercontent.com/49113443/146638675-4080f5a5-a90e-4263-bfaa-423d4518fe1d.png)


Рисунок 2 – Запись для запуска Grafana-контейнера.


![image](https://user-images.githubusercontent.com/49113443/146638697-05db91ee-be8a-4af8-9e46-4521b5c3d85d.png)


Рисунок 3 – Вспомогательные сервисы, запущенные в контейнерах.


![image](https://user-images.githubusercontent.com/49113443/146638701-27d1bbd3-46cf-4b4d-9bdb-1a9e86f95b86.png)


Рисунок 4 – Настройка окружения для контейнеров.


Далее перед запуском контейнеров командой `docker-compose up` необходимо добавить конфигурационных файл для Prometheus в директорию `/etc/prometheus`, как показано на рисунке 5.


![image](https://user-images.githubusercontent.com/49113443/146638718-26071ad2-7ccb-4305-8baa-5508299dbf71.png)
Рисунок 5 – конфигурационный файл Prometheus.


Здесь мы указываем параметры, которые Prometheus использует для того, чтобы подхватить источники данных, а также частоту опроса этих источников, которая в данном случае указывает на то, что Prometheus будет производить опрос каждые 15 секунд.

Для того, чтобы теперь добавить Prometheus в качестве источника данных в Grafana, нам необходимо указать тип протокола прикладного уровня, IP-адрес, а также порт, который существует во внутренней сети контейнеров, запущенных одним и тем же `docker-compose.yml` файлом. Эта процедура показана на рисунке 6.


![image](https://user-images.githubusercontent.com/49113443/146638725-bfa5348c-f53b-40e9-97ec-81be1c87e0d9.png)
Рисунок 6 – Добавление Prometheus в качестве источника данных в Grafana.


Затем необходимо добавить дашборд, который визуализирует информацию от Falco, сделать это можно импортировав его, по специальному коду, указанному на странице плагинов для Grafana, так и с помощью json-файла. Вне зависимости от выбранного способа установки итоговый дашборд представлен на рисунке 7.


![image](https://user-images.githubusercontent.com/49113443/146638733-c185fbc7-7ecc-4f96-9a2e-d13326fc0959.png)
Рисунок 7 – Дашборд для визуализации данных с Falco.


Завершающим этапом этой части работы является добавление дашборда для визуализации информации о производительности узла, для этого нужно будет добавить еще одну запись в конфигурационный файл для Prometheus, как показано на рисунке 8.

![image](https://user-images.githubusercontent.com/49113443/146638757-e625d98a-f4b7-49f4-9e9d-04884b2826a1.png)

Рисунок 8 – Запись о новой задаче в конфигурационном файле Prometheus.

И добавить аналогичным образом, через импорт, новый дашборд в Grafana. Итоговый вид дашборда показан на рисунке 9.


![image](https://user-images.githubusercontent.com/49113443/146638768-4a1fac58-c297-4237-bd93-30579fdc7472.png)
Рисунок 9 — Дашборд для анализа производительности узла.

**Вывод**: В данной работе мы произвели настройку сервиса мониторинга и сервиса визуализации для получения и отображения данных, которые собираются с Falco.
